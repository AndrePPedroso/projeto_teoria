
<div class="container mt-5">
    <h1>Simulação de Monte Carlo para Preços de Ações</h1>
    <form id="monteCarloForm" method="post" action="{% url 'monte_carlos_simulator' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="S0">Preço Inicial (S0):</label>
            <input type="number" class="form-control" id="S0" name="S0" value="100" min="1" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="mu">Retorno Anual (mu):</label>
            <input type="number" class="form-control" id="mu" name="mu" value="0.15" step="0.0001" max="1" required>
        </div>
        <div class="form-group">
            <label for="sigma">Volatilidade (sigma):</label>
            <input type="number" class="form-control" id="sigma" name="sigma" value="0.3" step="0.0001" max="1" required>
        </div>
        <div class="form-group">
            <label for="time_unit">Unidade de Tempo:</label>
            <select class="form-control" id="time_unit" name="time_unit" required>
                <option value="Dia">Dia</option>
                <option value="Semana">Semana</option>
                <option value="Mês">Mês</option>
                <option value="Ano">Ano</option>
            </select>
        </div>
        <div class="form-group">
            <label for="num_periods">Número de Períodos:</label>
            <input type="number" class="form-control" id="num_periods" name="num_periods" value="10" min="1" required>
        </div>
        <div class="form-group">
            <label for="num_simulations">Número de Simulações:</label>
            <input type="number" class="form-control" id="num_simulations" name="num_simulations" value="100" min="1" required>
        </div>
        <button type="button" class="btn btn-primary" onclick="submitMonteCarloForm()">Executar Simulação</button>
    </form>

    <!-- Result Section -->
    <div class="result-section" id="resultSection" style="display: none;">
        <h3>Resultados da Simulação</h3>
        <div class="row">
            <div class="col-md-6">
                <img id="pricePlot" class="img-fluid" alt="Gráfico de Preço">
            </div>
            <div class="col-md-6">
                <img id="distributionPlot" class="img-fluid" alt="Distribuição dos Preços Finais">
            </div>
        </div>
        <h4>Estatísticas Descritivas</h4>
        <table class="table table-bordered" id="statisticsTable"></table>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    function submitMonteCarloForm() {
        const form = $('#monteCarloForm');
        $.ajax({
            url: form.attr('action'),
            method: 'POST',
            data: form.serialize(),
            success: function(data) {
                $('#resultSection').show();
                $('#pricePlot').attr('src', 'data:image/png;base64,' + data.price_plot);
                $('#distributionPlot').attr('src', 'data:image/png;base64,' + data.distribution_plot);
            
                // Exibir estatísticas
                const statsTable = $('#statisticsTable');
                statsTable.empty();
                for (const [key, value] of Object.entries(data.statistics)) {
                    statsTable.append(`<tr><th>${key}</th><td>${value.toFixed(2)}</td></tr>`);
                }
            },
            error: function(error) {
                alert("Erro na simulação: " + error);
            }
        });
    }
</script>
