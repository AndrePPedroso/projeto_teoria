{% load static %}
<div class="container mt-5">
    <h1>
        {% if request.session.language == 'en' %}Cox-Ross-Rubinstein Binomial Tree Model{% else %}Modelo de Árvore Binomial de Cox-Ross-Rubinstein{% endif %}
    </h1>
    
    <div class="card mb-4">
        <div class="card-header">
            {% if request.session.language == 'en' %}Description{% else %}Descrição{% endif %}
        </div>
        <div class="card-body">
            <p>
                {% if request.session.language == 'en' %}
                The Cox-Ross-Rubinstein (CRR) model, also known as the Binomial Options Pricing Model, is a discrete-time approach to options pricing. This model builds a binomial tree of possible future stock prices and works backward through the tree to determine option values at each node.
                {% else %}
                O modelo de Cox-Ross-Rubinstein (CRR), também conhecido como Modelo Binomial de Precificação de Opções, é uma abordagem de tempo discreto para a precificação de opções. Este modelo constrói uma árvore binomial de possíveis preços futuros de ações e trabalha retrospectivamente através da árvore para determinar os valores das opções em cada nó.
                {% endif %}
            </p>
            <p>
                {% if request.session.language == 'en' %}
                <strong>Key Parameters:</strong> Underlying asset price (S), Strike price (K), Time to expiration (T), Risk-free rate (r), Volatility (σ), Dividend yield (q), and Number of steps (n)
                {% else %}
                <strong>Parâmetros Principais:</strong> Preço do ativo subjacente (S), Preço de exercício (K), Tempo até o vencimento (T), Taxa livre de risco (r), Volatilidade (σ), Rendimento de dividendos (q), e Número de passos (n)
                {% endif %}
            </p>
            <p>
                {% if request.session.language == 'en' %}
                The CRR model can value both European and American options and provides a visual representation of how option prices evolve over time.
                {% else %}
                O modelo CRR pode avaliar tanto opções europeias quanto americanas e fornece uma representação visual de como os preços das opções evoluem ao longo do tempo.
                {% endif %}
            </p>
        </div>
    </div>

    <div class="text-center mb-4">
        <button class="btn btn-info" type="button" data-bs-toggle="modal" data-bs-target="#coxRossRubinsteinExplanationModal">
            {% if request.session.language == 'en' %}Learn More About Cox-Ross-Rubinstein{% else %}Saiba Mais Sobre Cox-Ross-Rubinstein{% endif %}
        </button>
    </div>

    <form id="coxRossRubinsteinForm">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        {% if request.session.language == 'en' %}Option Parameters{% else %}Parâmetros da Opção{% endif %}
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-3">
                            <label for="option_type">
                                {% if request.session.language == 'en' %}Option Type:{% else %}Tipo de Opção:{% endif %}
                            </label>
                            <div class="d-flex">
                                <div class="form-check me-4">
                                    <input class="form-check-input" type="radio" name="option_type" id="callOptionCRR" value="call" checked>
                                    <label class="form-check-label" for="callOptionCRR">
                                        {% if request.session.language == 'en' %}Call Option (Right to Buy){% else %}Opção de Compra (Direito de Comprar){% endif %}
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="option_type" id="putOptionCRR" value="put">
                                    <label class="form-check-label" for="putOptionCRR">
                                        {% if request.session.language == 'en' %}Put Option (Right to Sell){% else %}Opção de Venda (Direito de Vender){% endif %}
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="asset_price">
                                {% if request.session.language == 'en' %}Underlying Asset Price (S):{% else %}Preço do Ativo Subjacente (S):{% endif %}
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" id="asset_price" name="asset_price" class="form-control" min="0.01" step="0.01" value="100" required>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="exercise_price">
                                {% if request.session.language == 'en' %}Strike Price (K):{% else %}Preço de Exercício (K):{% endif %}
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" id="exercise_price" name="exercise_price" class="form-control" min="0.01" step="0.01" value="100" required>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="time_to_expiration">
                                {% if request.session.language == 'en' %}Time to Expiration (days):{% else %}Tempo até o Vencimento (dias):{% endif %}
                            </label>
                            <input type="number" id="time_to_expiration" name="time_to_expiration" class="form-control" min="1" step="1" value="30" required>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        {% if request.session.language == 'en' %}Market Parameters{% else %}Parâmetros de Mercado{% endif %}
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-3">
                            <label for="interest_rate">
                                {% if request.session.language == 'en' %}Risk-Free Interest Rate (r, %):{% else %}Taxa de Juros Livre de Risco (r, %):{% endif %}
                            </label>
                            <div class="input-group">
                                <input type="number" id="interest_rate" name="interest_rate" class="form-control" min="0" max="100" step="0.01" value="5" required>
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="volatility">
                                {% if request.session.language == 'en' %}Volatility (σ, %):{% else %}Volatilidade (σ, %):{% endif %}
                            </label>
                            <div class="input-group">
                                <input type="number" id="volatility" name="volatility" class="form-control" min="0.1" max="200" step="0.1" value="30" required>
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="dividend_yield">
                                {% if request.session.language == 'en' %}Dividend Yield (q, %):{% else %}Rendimento de Dividendos (q, %):{% endif %}
                            </label>
                            <div class="input-group">
                                <input type="number" id="dividend_yield" name="dividend_yield" class="form-control" min="0" max="100" step="0.01" value="0" required>
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="steps">
                                {% if request.session.language == 'en' %}Number of Steps:{% else %}Número de Passos:{% endif %}
                            </label>
                            <div class="input-group d-flex flex-column">
                                <input style="width:100px;" type="number" id="steps" name="steps" class="form-control" min="1" max="10" step="1" value="3" required>
                                <div class="form-text">
                                    {% if request.session.language == 'en' %}
                                    For tree visualization, max 10 steps (3-5 recommended for clarity)
                                    {% else %}
                                    Para visualização da árvore, máximo 10 passos (3-5 recomendados para clareza)
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-end mb-4">
                    <button type="button" class="btn btn-secondary me-2" onclick="resetCoxRossRubinsteinForm()">
                        {% if request.session.language == 'en' %}Reset{% else %}Reiniciar{% endif %}
                    </button>
                    <button type="button" class="btn btn-primary" id="calculateBtnCRR" onclick="handleCRRSubmit()">
                        {% if request.session.language == 'en' %}Calculate Option Value{% else %}Calcular Valor da Opção{% endif %}
                    </button>
                </div>
            </div>
        </div>
    </form>

    <div id="loadingSpinnerCRR" class="text-center my-4" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    
    <div id="coxRossRubinsteinResults" class="card mb-4" style="display: none;">
        <div class="card-header">
            {% if request.session.language == 'en' %}Option Pricing Results{% else %}Resultados do Apreçamento da Opção{% endif %}
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-light">
                            {% if request.session.language == 'en' %}Option Value{% else %}Valor da Opção{% endif %}
                        </div>
                        <div class="card-body text-center">
                            <h3 id="optionPriceCRR">-</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-light">
                            {% if request.session.language == 'en' %}Greeks (Sensitivity Measures){% else %}Gregas (Medidas de Sensibilidade){% endif %}
                        </div>
                        <div class="card-body">
                            <table class="table table-sm">
                                <tbody>
                                    <tr>
                                        <td>Delta:</td>
                                        <td id="deltaMeasureCRR">-</td>
                                        <td>{% if request.session.language == 'en' %}Price sensitivity to underlying asset{% else %}Sensibilidade do preço ao ativo subjacente{% endif %}</td>
                                    </tr>
                                    <tr>
                                        <td>Gamma:</td>
                                        <td id="gammaMeasureCRR">-</td>
                                        <td>{% if request.session.language == 'en' %}Rate of change of delta{% else %}Taxa de variação do delta{% endif %}</td>
                                    </tr>
                                    <tr>
                                        <td>Theta:</td>
                                        <td id="thetaMeasureCRR">-</td>
                                        <td>{% if request.session.language == 'en' %}Time decay per day{% else %}Decaimento do tempo por dia{% endif %}</td>
                                    </tr>
                                    <tr>
                                        <td>Vega:</td>
                                        <td id="vegaMeasureCRR">-</td>
                                        <td>{% if request.session.language == 'en' %}Sensitivity to volatility{% else %}Sensibilidade à volatilidade{% endif %}</td>
                                    </tr>
                                    <tr>
                                        <td>Rho:</td>
                                        <td id="rhoMeasureCRR">-</td>
                                        <td>{% if request.session.language == 'en' %}Sensitivity to interest rate{% else %}Sensibilidade à taxa de juros{% endif %}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header bg-light">
                    {% if request.session.language == 'en' %}Binomial Model Parameters{% else %}Parâmetros do Modelo Binomial{% endif %}
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-secondary">
                                <tr>
                                    <th>{% if request.session.language == 'en' %}PARAMETER{% else %}PARÂMETRO{% endif %}</th>
                                    <th>{% if request.session.language == 'en' %}VALUE{% else %}VALOR{% endif %}</th>
                                    <th>{% if request.session.language == 'en' %}DESCRIPTION{% else %}DESCRIÇÃO{% endif %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>u</td>
                                    <td id="upFactorCRR">-</td>
                                    <td>{% if request.session.language == 'en' %}Up movement factor{% else %}Fator de movimento para cima{% endif %}</td>
                                </tr>
                                <tr>
                                    <td>d</td>
                                    <td id="downFactorCRR">-</td>
                                    <td>{% if request.session.language == 'en' %}Down movement factor{% else %}Fator de movimento para baixo{% endif %}</td>
                                </tr>
                                <tr>
                                    <td>p</td>
                                    <td id="probCRR">-</td>
                                    <td>{% if request.session.language == 'en' %}Risk-neutral probability{% else %}Probabilidade neutra ao risco{% endif %}</td>
                                </tr>
                                <tr>
                                    <td>dt</td>
                                    <td id="dtCRR">-</td>
                                    <td>{% if request.session.language == 'en' %}Time step (in years){% else %}Passo de tempo (em anos){% endif %}</td>
                                </tr>
                                <tr>
                                    <td>{% if request.session.language == 'en' %}Break-Even Point{% else %}Ponto de Equilíbrio{% endif %}</td>
                                    <td id="breakEvenValueCRR">-</td>
                                    <td>{% if request.session.language == 'en' %}Asset price where option investment breaks even at expiration{% else %}Preço do ativo onde o investimento na opção atinge o equilíbrio no vencimento{% endif %}</td>
                                </tr>
                                <tr>
                                    <td>{% if request.session.language == 'en' %}Maximum Loss{% else %}Perda Máxima{% endif %}</td>
                                    <td id="maxLossValueCRR">-</td>
                                    <td>{% if request.session.language == 'en' %}Maximum potential loss for the option buyer{% else %}Perda potencial máxima para o comprador da opção{% endif %}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header bg-light">
                    {% if request.session.language == 'en' %}Real Options Analysis{% else %}Análise de Opções Reais{% endif %}
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-secondary">
                                <tr>
                                    <th>{% if request.session.language == 'en' %}METRIC{% else %}MÉTRICA{% endif %}</th>
                                    <th>{% if request.session.language == 'en' %}VALUE{% else %}VALOR{% endif %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{% if request.session.language == 'en' %}Traditional NPV (without flexibility){% else %}VPL Tradicional (sem flexibilidade){% endif %}</td>
                                    <td id="traditionalNPV">-</td>
                                </tr>
                                <tr>
                                    <td>{% if request.session.language == 'en' %}Expanded NPV (with option value){% else %}VPL Expandido (com valor da opção){% endif %}</td>
                                    <td id="expandedNPV">-</td>
                                </tr>
                                <tr>
                                    <td>{% if request.session.language == 'en' %}Value of Flexibility{% else %}Valor da Flexibilidade{% endif %}</td>
                                    <td id="flexibilityValue">-</td>
                                </tr>
                                <tr>
                                    <td>{% if request.session.language == 'en' %}Option Value / Investment Cost Ratio{% else %}Razão Valor da Opção / Custo de Investimento{% endif %}</td>
                                    <td id="optionRatio">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <h5>{% if request.session.language == 'en' %}Binomial Lattice Visualization{% else %}Visualização da Treliça Binomial{% endif %}</h5>
                <div id="latticeContainerCRR" class="text-center overflow-auto" style="min-height: 300px;"></div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header bg-light">
                    {% if request.session.language == 'en' %}Interpretation of Results{% else %}Interpretação dos Resultados{% endif %}
                </div>
                <div class="card-body">
                    <div id="interpretationCRR">
                        </div>
                </div>
            </div>
            
            <div class="text-center">
                <button type="button" class="btn btn-primary" id="recalculateBtnCRR" onclick="handleCRRSubmit()">
                    {% if request.session.language == 'en' %}Recalculate{% else %}Recalcular{% endif %}
                </button>
                <button type="button" class="btn btn-secondary" onclick="resetCoxRossRubinsteinForm()">
                    {% if request.session.language == 'en' %}Reset{% else %}Reiniciar{% endif %}
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    // Define the handleCRRSubmit function globally
    function handleCRRSubmit() {
        // Get fresh references to the DOM elements each time
        const loadingSpinner = document.getElementById('loadingSpinnerCRR');
        const resultsContainer = document.getElementById('coxRossRubinsteinResults');
        const form = document.getElementById('coxRossRubinsteinForm');
        const latticeContainer = document.getElementById('latticeContainerCRR');
        
        // Check if elements exist before using them
        if (!loadingSpinner || !resultsContainer || !form || !latticeContainer) {
            console.error('Required DOM elements not found:', {
                loadingSpinner: !!loadingSpinner,
                resultsContainer: !!resultsContainer,
                form: !!form,
                latticeContainer: !!latticeContainer
            });
            alert('An error occurred. Please refresh the page and try again.');
            return;
        }
        
        loadingSpinner.style.display = 'block';
        resultsContainer.style.display = 'none';
        
        // Get form data
        const formData = new FormData(form);
        
        // Log form data for debugging
        console.log('Submitting CRR form data:');
        for (let pair of formData.entries()) {
            console.log(pair[0] + ': ' + pair[1]);
        }
        
        // Send AJAX request to backend
        fetch('{% url "cox_ross_rubinstein_api" %}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        })
        .then(response => response.json())
        .then(data => {
            // Hide loading spinner
            loadingSpinner.style.display = 'none';
            
            if (data.error) {
                alert(data.error);
                return;
            }
            
            // Update option price and Greeks
            document.getElementById('optionPriceCRR').textContent = '$' + data.option_price;
            document.getElementById('deltaMeasureCRR').textContent = data.greeks.delta;
            document.getElementById('gammaMeasureCRR').textContent = data.greeks.gamma;
            document.getElementById('thetaMeasureCRR').textContent = data.greeks.theta;
            document.getElementById('vegaMeasureCRR').textContent = data.greeks.vega;
            document.getElementById('rhoMeasureCRR').textContent = data.greeks.rho;
            
            // Update binomial model parameters
            document.getElementById('upFactorCRR').textContent = data.u;
            document.getElementById('downFactorCRR').textContent = data.d;
            document.getElementById('probCRR').textContent = data.p;
            document.getElementById('dtCRR').textContent = data.dt;
            document.getElementById('breakEvenValueCRR').textContent = '$' + data.break_even;
            document.getElementById('maxLossValueCRR').textContent = '$' + data.max_loss;
            
            // Update real options analysis
            document.getElementById('traditionalNPV').textContent = '$' + data.traditional_npv.toFixed(2);
            document.getElementById('expandedNPV').textContent = '$' + data.expanded_npv.toFixed(2);
            document.getElementById('flexibilityValue').textContent = '$' + data.flexibility_value.toFixed(2);
            document.getElementById('optionRatio').textContent = data.option_ratio.toFixed(4);
            
            // Update lattice visualization
            latticeContainer.innerHTML = data.lattice_html;
            
            // Update interpretation
            document.getElementById('interpretationCRR').innerHTML = data.interpretation;
            
            // Show results
            resultsContainer.style.display = 'block';
            
            // Scroll to results
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        })
        .catch(error => {
            console.error('Error:', error);
            loadingSpinner.style.display = 'none';
            alert('An error occurred while processing your request.');
        });
    }
    
    // Function to reset the form
    function resetCoxRossRubinsteinForm() {
        document.getElementById('coxRossRubinsteinForm').reset();
        document.getElementById('coxRossRubinsteinResults').style.display = 'none';
        document.getElementById('latticeContainerCRR').innerHTML = '';
    }
    
    // Initialize when DOM is loaded - just for checking elements exist
    document.addEventListener('DOMContentLoaded', function() {
        const crrForm = document.getElementById('coxRossRubinsteinForm');
        const crrLoadingSpinner = document.getElementById('loadingSpinnerCRR');
        const crrResultsContainer = document.getElementById('coxRossRubinsteinResults');
        const calculateCRRBtn = document.getElementById('calculateBtnCRR');
        const recalculateCRRBtn = document.getElementById('recalculateBtnCRR');
        const latticeContainer = document.getElementById('latticeContainerCRR');
        
        console.log('DOM fully loaded - CRR Elements check:', {
            form: crrForm ? 'Found' : 'Not found',
            loadingSpinner: crrLoadingSpinner ? 'Found' : 'Not found',
            resultsContainer: crrResultsContainer ? 'Found' : 'Not found',
            calculateBtn: calculateCRRBtn ? 'Found' : 'Not found',
            recalculateBtn: recalculateCRRBtn ? 'Found' : 'Not found',
            latticeContainer: latticeContainer ? 'Found' : 'Not found'
        });
    });
</script>

<div class="modal fade" id="coxRossRubinsteinExplanationModal" tabindex="-1" aria-labelledby="coxRossRubinsteinExplanationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="coxRossRubinsteinExplanationModalLabel">
            {% if request.session.language == 'en' %}Diving Deeper into Cox-Ross-Rubinstein Binomial Tree Model{% else %}Aprofundando no Modelo de Árvore Binomial de Cox-Ross-Rubinstein{% endif %}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {% if request.session.language == 'en' %}
        <p>
        The Cox-Ross-Rubinstein (CRR) model, often referred to as the Binomial Options Pricing Model, is a flexible and intuitive method for valuing options. Unlike the Black-Scholes models which are continuous-time, CRR is a discrete-time model that constructs a "tree" of possible future stock prices. This approach allows for the valuation of both European and American options, providing a visual representation of how option values evolve over time.
        </p>

        <h5>How it Works: Building the Binomial Tree</h5>
        <ul>
            <li><strong>Nodes and Paths:</strong> The model divides the time to expiration into a series of discrete steps (nodes). At each step, the underlying asset's price can either move up (to an "up" node) or down (to a "down" node).</li>
            <li><strong>Up (u) and Down (d) Factors:</strong> These factors determine the magnitude of price movements. They are derived from the volatility (σ) and time step (Δt) as:
                <ul>
                    <li><code>u = e^(σ * sqrt(Δt))</code></li>
                    <li><code>d = 1 / u</code></li>
                </ul>
                Where `e` is Euler's number.</li>
            <li><strong>Risk-Neutral Probability (p):</strong> The probability 'p' of an up movement is calculated under a risk-neutral assumption, meaning investors are indifferent to risk. It ensures that the expected return of the stock in the risk-neutral world is the risk-free rate:
                <ul>
                    <li><code>p = (e^((r - q) * Δt) - d) / (u - d)</code></li>
                </ul>
                Where 'r' is the risk-free rate and 'q' is the continuous dividend yield.</li>
            <li><strong>Backward Induction:</strong> The valuation process starts at the option's expiration (the final nodes of the tree). The option's payoff (intrinsic value) is calculated at each final node. Then, working backward through the tree, the option's value at each earlier node is calculated by taking the risk-neutral expectation of its future values, discounted back at the risk-free rate. For American options, early exercise is considered at each node.</li>
        </ul>

        <h5>Practical Applications</h5>
        <p>The CRR model is highly versatile and widely used for:</p>
        <ul>
            <li><strong>Valuing American Options:</strong> Unlike Black-Scholes, CRR can easily handle American options because it evaluates the option at each time step, allowing for the decision of early exercise.</li>
            <li><strong>Real Options Analysis:</strong> Its flexibility to model sequential decisions and uncertainty makes it ideal for real options (e.g., option to expand, contract, abandon, or defer a project). Each node in the tree can represent a decision point.</li>
            <li><strong>Options on Assets with Complex Features:</strong> Can be adapted for options with non-constant volatility, non-continuous dividends (by adjusting tree nodes), or other exotic features.</li>
            <li><strong>Educational Tool:</strong> Provides a transparent, step-by-step visual representation of option valuation, making it excellent for teaching and understanding option behavior.</li>
        </ul>

        <h5>Limitations</h5>
        <ul>
            <li><strong>Computational Intensity:</strong> As the number of steps increases for accuracy, the computational effort grows exponentially. For very long maturities or very high numbers of steps, it can become computationally expensive.</li>
            <li><strong>Discrete Time:</strong> The model assumes discrete time steps, which is an approximation of continuous time. While increasing steps improves accuracy, it never perfectly matches continuous-time models.</li>
            <li><strong>Input Sensitivity:</strong> Like Black-Scholes, CRR is sensitive to inputs, especially volatility.</li>
            <li><strong>Simplification of Reality:</strong> Assumes only two possible price movements per step, which is a simplification of continuous price changes.</li>
        </ul>
        <p>The CRR model is a powerful and intuitive tool for option pricing, especially when dealing with American-style options or real options scenarios where decision points and flexibility are key.</p>
        {% else %}
        <p>
        O modelo de Cox-Ross-Rubinstein (CRR), frequentemente referido como Modelo Binomial de Precificação de Opções, é um método flexível e intuitivo para avaliar opções. Diferente dos modelos Black-Scholes que são de tempo contínuo, o CRR é um modelo de tempo discreto que constrói uma "árvore" de possíveis preços futuros de ações. Esta abordagem permite a avaliação de opções tanto europeias quanto americanas, fornecendo uma representação visual de como os valores das opções evoluem ao longo do tempo.
        </p>

        <h5>Como Funciona: Construindo a Árvore Binomial</h5>
        <ul>
            <li><strong>Nós e Caminhos:</strong> O modelo divide o tempo até o vencimento em uma série de passos discretos (nós). Em cada passo, o preço do ativo subjacente pode se mover para cima (para um nó "para cima") ou para baixo (para um nó "para baixo").</li>
            <li><strong>Fatores de Subida (u) e Descida (d):</strong> Estes fatores determinam a magnitude dos movimentos de preço. Eles são derivados da volatilidade (σ) e do passo de tempo (Δt) como:
                <ul>
                    <li><code>u = e^(σ * sqrt(Δt))</code></li>
                    <li><code>d = 1 / u</code></li>
                </ul>
                Onde `e` é o número de Euler.</li>
            <li><strong>Probabilidade Neutra ao Risco (p):</strong> A probabilidade 'p' de um movimento para cima é calculada sob uma premissa neutra ao risco, o que significa que os investidores são indiferentes ao risco. Garante que o retorno esperado do estoque no mundo neutro ao risco seja a taxa livre de risco:
                <ul>
                    <li><code>p = (e^((r - q) * Δt) - d) / (u - d)</code></li>
                </ul>
                Onde 'r' é a taxa livre de risco e 'q' é o rendimento de dividendos contínuo.</li>
            <li><strong>Indução Retroativa:</strong> O processo de avaliação começa no vencimento da opção (os nós finais da árvore). O payoff (valor intrínseco) da opção é calculado em cada nó final. Em seguida, trabalhando retrospectivamente através da árvore, o valor da opção em cada nó anterior é calculado pegando a expectativa neutra ao risco de seus valores futuros, descontados de volta à taxa livre de risco. Para opções americanas, o exercício antecipado é considerado em cada nó.</li>
        </ul>

        <h5>Aplicações Práticas</h5>
        <p>O modelo CRR é altamente versátil e amplamente utilizado para:</p>
        <ul>
            <li><strong>Avaliação de Opções Americanas:</strong> Diferente do Black-Scholes, o CRR pode facilmente lidar com opções americanas porque avalia a opção em cada passo do tempo, permitindo a decisão de exercício antecipado.</li>
            <li><strong>Análise de Opções Reais:</strong> Sua flexibilidade para modelar decisões sequenciais e incerteza o torna ideal para opções reais (por exemplo, opção de expandir, contrair, abandonar ou adiar um projeto). Cada nó na árvore pode representar um ponto de decisão.</li>
            <li><strong>Opções sobre Ativos com Características Complexas:</strong> Pode ser adaptado para opções com volatilidade não constante, dividendos não contínuos (ajustando os nós da árvore) ou outras características exóticas.</li>
            <li><strong>Ferramenta Educacional:</strong> Fornece uma representação visual transparente e passo a passo da avaliação de opções, tornando-o excelente para ensinar e entender o comportamento das opções.</li>
        </ul>

        <h5>Limitações</h5>
        <ul>
            <li><strong>Intensidade Computacional:</strong> À medida que o número de passos aumenta para maior precisão, o esforço computacional cresce exponencialmente. Para vencimentos muito longos ou um número muito alto de passos, pode se tornar computacionalmente caro.</li>
            <li><strong>Tempo Discreto:</strong> O modelo assume passos de tempo discretos, que é uma aproximação do tempo contínuo. Embora o aumento dos passos melhore a precisão, nunca corresponde perfeitamente aos modelos de tempo contínuo.</li>
            <li><strong>Sensibilidade de Entrada:</strong> Assim como Black-Scholes, o CRR é sensível às entradas, especialmente à volatilidade.</li>
            <li><strong>Simplificação da Realidade:</strong> Assume apenas dois possíveis movimentos de preço por passo, o que é uma simplificação das mudanças contínuas de preço.</li>
        </ul>
        <p>O modelo CRR é uma ferramenta poderosa e intuitiva para precificação de opções, especialmente ao lidar com opções do estilo americano ou cenários de opções reais onde os pontos de decisão e a flexibilidade são fundamentais.</p>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            {% if request.session.language == 'en' %}Close{% else %}Fechar{% endif %}
        </button>
      </div>
    </div>
  </div>
</div>